<html>
  <head>
    <title>NetLogo Applet</title>
    <style type="text/css">
      body { font: 16px sans-serif;
        margin: 1.0em 2.0em;
        background-color: white;}
      #appletwrapper { border: 1px solid gray;
        padding: 10px;
        width: 630px;
        height: 520px;
        background-color: #F0F0F0; }
      applet { border: 1px solid gray;
        padding: 10px;
        background-color: #FF8080; }
      ul {
        list-style-type: none;
        margin: 1.0em 0em;
        width: 100%; }
        ul li {
          display: table-cell;
          vertical-align: middle;
          margin: 0em;
          padding: 0em 1em; }
      pre { font-size: 0.7em;
         background-color: #F0F0F0; }
    </style>
  </head>
  <body>
    <p>NetLogo Applet</p>
    <p>
      <div id="appletwrapper">
        <applet id="applet" code="org.nlogo.lite.Applet" archive="NetLogoLite.jar"  width="600" height="500">
          <param name="DefaultModel" value="GCCModel.v3.nlogo">
          <param name="MAYSCRIPT" value="true"/>
        </applet>
      </div>
    </p>
    <ul>
      <li><button id="save-state">Save State</button></li>
      <li><button id="restore-state">Restore State</button></li>
    </ul>
    <pre id="world-state"><pre>
    <script type="text/javascript">
      window.onload=function() {
        var applet        = document.getElementById("applet");
        var world_state   = document.getElementById("world-state");
        var save_state    = document.getElementById("save-state");
        var restore_state = document.getElementById("restore-state");
        var state, world;

        save_state.onclick = function() {
          world = applet.panel().workspace().org$nlogo$lite$LiteWorkspace$$world;
          var sw = new applet.Packages.java.io.StringWriter();
          var pw = new applet.Packages.java.io.PrintWriter(sw);
          world.exportWorld(pw, true);
          state = sw.toString();
          world_state.textContent = state;
        }

        restore_state.onclick = function() {
          if (state) {
            var errorHandler = applet.Packages.org.nlogo.api.ImportErrorHandler;
            var importerUser = applet.Packages.org.nlogo.api.ImporterUser;
            var bufferedReader = applet.Packages.java.io.BufferedReader;
            var sr = new applet.Packages.java.io.StringReader(state);
            world.importWorld(errorHandler, importerUser, sr, bufferedReader);
            panel().repaint();
          }
        }
      };
    </script>
  </body>
</html>
